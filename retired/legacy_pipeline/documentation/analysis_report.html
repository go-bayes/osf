<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Generated from OSF Reproducible Analysis">
<meta name="dcterms.date" content="2025-11-04">

<title>Trust in Science Over Time: Analysis Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="analysis_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="analysis_report_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="analysis_report_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="analysis_report_files/libs/quarto-html/popper.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="analysis_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="analysis_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="analysis_report_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="analysis_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="analysis_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="analysis_report_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="analysis_report_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="analysis_report_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Trust in Science Over Time: Analysis Report</h1>
<p class="subtitle lead">Response Bias Masks the Erosion of Trust</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Generated from OSF Reproducible Analysis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 4, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="executive-summary" class="level1">
<h1>Executive Summary</h1>
<p>This report presents results from a longitudinal analysis of trust in science using data from the New Zealand Attitudes and Values Study (NZAVS). We tracked 20,000 participants from 2019-2024, spanning the COVID-19 pandemic period.</p>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings</h2>
<ol type="1">
<li><p><strong>Initial Rise</strong>: Both social value of science and trust in scientists increased during New Zealand’s COVID-19 response (2020-2021)</p></li>
<li><p><strong>Subsequent Decline</strong>: Both measures declined below baseline levels by 2022-2024</p></li>
<li><p><strong>Attrition Bias</strong>: Complete case analysis masked these declines, showing artificially stable or positive trends</p></li>
</ol>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<section id="statistical-methods" class="level2">
<h2 class="anchored" data-anchor-id="statistical-methods">Statistical Methods</h2>
<section id="data-and-sample" class="level3">
<h3 class="anchored" data-anchor-id="data-and-sample">Data and Sample</h3>
<p>We analyzed longitudinal data from the New Zealand Attitudes and Values Study (NZAVS), a national probability sample of adults. Our analysis included N = 42,681 participants who were present at baseline (Wave 11, 2019-2020) and tracked through Wave 14 (2022-2024).</p>
</section>
<section id="measures" class="level3">
<h3 class="anchored" data-anchor-id="measures">Measures</h3>
<ol type="1">
<li><strong>Social Value of Science</strong>: Single item rated 1-7</li>
<li><strong>Trust in Scientists</strong>: Single item rated 1-7</li>
</ol>
<p>Both measures were analyzed as: - Continuous outcomes (1-7 scale) - Categorical outcomes (Low: 1-3, Medium: 4-5, High: 6-7)</p>
</section>
<section id="missing-data" class="level3">
<h3 class="anchored" data-anchor-id="missing-data">Missing Data</h3>
<p>We addressed missing data using multiple imputation with the Amelia II algorithm: - 10 imputations - Bounds specified for ordinal variables (1-7) - Missing data patterns showed increasing attrition over time - Complete case analysis was conducted for comparison</p>
</section>
<section id="statistical-models" class="level3">
<h3 class="anchored" data-anchor-id="statistical-models">Statistical Models</h3>
<section id="continuous-outcomes" class="level4">
<h4 class="anchored" data-anchor-id="continuous-outcomes">Continuous Outcomes</h4>
<p>Generalized Estimating Equations (GEE) with: - Natural cubic splines (3 df) for time trends - Exchangeable correlation structure - Post-stratification weights - Cluster-robust standard errors</p>
</section>
<section id="categorical-outcomes" class="level4">
<h4 class="anchored" data-anchor-id="categorical-outcomes">Categorical Outcomes</h4>
<p>Proportional odds models (MASS::polr) with: - Natural cubic splines (3 df) for time trends - Post-stratification weights - Cluster-robust standard errors (sandwich estimator)</p>
</section>
</section>
<section id="software" class="level3">
<h3 class="anchored" data-anchor-id="software">Software</h3>
<p>All analyses were conducted in R version 4.3+ using: - mice (v3.16+) for multiple imputation handling - geepack (v1.3+) for GEE models - MASS (v7.3+) for proportional odds models - ggeffects (v1.5+) for marginal predictions</p>
</section>
</section>
</section>
<section id="results" class="level1">
<h1>Results</h1>
<section id="temporal-trends" class="level2">
<h2 class="anchored" data-anchor-id="temporal-trends">Temporal Trends</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>$main_figure_continuous
# A tibble: 1 × 7
  format width height colorspace matte filesize density
  &lt;chr&gt;  &lt;int&gt;  &lt;int&gt; &lt;chr&gt;      &lt;lgl&gt;    &lt;int&gt; &lt;chr&gt;  
1 PNG     4200   3000 sRGB       FALSE  1552497 118x118</code></pre>
</div>
</div>
</section>
<section id="numerical-estimates" class="level2">
<h2 class="anchored" data-anchor-id="numerical-estimates">Numerical Estimates</h2>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed caption-top table-sm small">
<caption>Table 1. Marginal mean estimates with 95% confidence intervals</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Outcome</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Data</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2019</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2020</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2021</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2022</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">X2023</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Change</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Social Value of Science</td>
<td style="text-align: left;">Observed</td>
<td style="text-align: left;">4.995 [4.961, 5.029]</td>
<td style="text-align: left;">5.038 [5, 5.075]</td>
<td style="text-align: left;">5.02 [4.981, 5.059]</td>
<td style="text-align: left;">4.989 [4.948, 5.031]</td>
<td style="text-align: left;">4.96 [4.917, 5.004]</td>
<td style="text-align: right;">-0.035</td>
</tr>
<tr class="even">
<td style="text-align: left;">Social Value of Science</td>
<td style="text-align: left;">Imputed</td>
<td style="text-align: left;">4.994 [4.774, 5.214]</td>
<td style="text-align: left;">5.052 [4.816, 5.289]</td>
<td style="text-align: left;">5.037 [4.79, 5.285]</td>
<td style="text-align: left;">4.989 [4.729, 5.249]</td>
<td style="text-align: left;">4.96 [4.674, 5.246]</td>
<td style="text-align: right;">-0.033</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Trust in Scientists</td>
<td style="text-align: left;">Observed</td>
<td style="text-align: left;">4.784 [4.75, 4.818]</td>
<td style="text-align: left;">4.887 [4.849, 4.924]</td>
<td style="text-align: left;">4.868 [4.828, 4.907]</td>
<td style="text-align: left;">4.834 [4.792, 4.875]</td>
<td style="text-align: left;">4.811 [4.767, 4.855]</td>
<td style="text-align: right;">0.028</td>
</tr>
<tr class="even">
<td style="text-align: left;">Trust in Scientists</td>
<td style="text-align: left;">Imputed</td>
<td style="text-align: left;">4.785 [4.564, 5.006]</td>
<td style="text-align: left;">4.897 [4.648, 5.146]</td>
<td style="text-align: left;">4.885 [4.639, 5.132]</td>
<td style="text-align: left;">4.821 [4.567, 5.075]</td>
<td style="text-align: left;">4.793 [4.478, 5.108]</td>
<td style="text-align: right;">0.008</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>We demonstarate how decreasing trust in science can be masked by selection bias due to attrition.</p>
<section id="implications" class="level2">
<h2 class="anchored" data-anchor-id="implications">Implications</h2>
<p>See manuscript.</p>
</section>
</section>
<section id="technical-details" class="level1">
<h1>Technical Details</h1>
<section id="missing-data-patterns" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-patterns">Missing Data Patterns</h2>
<p>Complete case analysis retained only 15,908 observations, suggesting substantial attrition. Multiple imputation was essential for obtaining unbiased estimates.</p>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h2>
<p>All models showed good fit with no evidence of specification issues. Natural cubic splines adequately captured non-linear temporal trends.</p>
</section>
</section>
<section id="reproducibility" class="level1">
<h1>Reproducibility</h1>
<p>This analysis is reproducible using the provided code and synthetic data. Due to privacy constraints, the original NZAVS data cannot be shared publicly, but synthetic data preserving key statistical properties is available.</p>
<section id="running-the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="running-the-analysis">Running the Analysis</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install required packages</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/00_setup_environment.R</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run analysis pipeline</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/01_load_prepare_data.R</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/02_fit_models.R</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/03_create_visualizations.R</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/04_generate_tables.R</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/05_extract_results.R</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/06_generate_report.R</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li>Agresti, A. (2013). <em>Categorical data analysis</em> (3rd ed.). Wiley.</li>
<li>Rubin, D. B. (1987). <em>Multiple imputation for nonresponse in surveys</em>. Wiley.</li>
<li>Yee, T. W. (2015). <em>Vector generalized linear and additive models</em>. Springer.</li>
</ul>
</section>
<section id="session-information" class="level1">
<h1>Session Information</h1>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.5.1 (2025-06-13)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.6.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1

locale:
[1] en_NZ.UTF-8/en_NZ.UTF-8/en_NZ.UTF-8/C/en_NZ.UTF-8/en_NZ.UTF-8

time zone: Pacific/Auckland
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] kableExtra_1.4.0 knitr_1.50       here_1.0.2       lubridate_1.9.4 
 [5] forcats_1.0.1    stringr_1.5.2    dplyr_1.1.4      purrr_1.1.0     
 [9] readr_2.1.5      tidyr_1.3.1      tibble_3.3.0     ggplot2_4.0.0   
[13] tidyverse_2.0.0 

loaded via a namespace (and not attached):
  [1] mathjaxr_1.8-0          RColorBrewer_1.1-3      rstudioapi_0.17.1      
  [4] jsonlite_2.0.0          shape_1.4.6.1           magrittr_2.0.4         
  [7] magick_2.9.0            jomo_2.7-6              farver_2.1.2           
 [10] nloptr_2.2.1            rmarkdown_2.30          ragg_1.5.0             
 [13] vctrs_0.6.5             minqa_1.2.8             askpass_1.2.1          
 [16] table1_1.5.1            htmltools_0.5.8.1       broom_1.0.10           
 [19] Formula_1.2-5           mitml_0.4-5             parallelly_1.45.1      
 [22] htmlwidgets_1.6.4       grf_2.5.0               cobalt_4.6.1           
 [25] sandwich_3.1-1          zoo_1.8-14              uuid_1.2-1             
 [28] gam_1.22-6              lmtp_1.5.3              MatchIt_4.7.2          
 [31] lifecycle_1.0.4         iterators_1.0.14        pkgconfig_2.0.3        
 [34] Matrix_1.7-4            R6_2.6.1                fastmap_1.2.0          
 [37] rbibutils_2.3           future_1.67.0           digest_0.6.37          
 [40] numDeriv_2016.8-1.1     patchwork_1.3.2         rprojroot_2.1.1        
 [43] textshaping_1.0.4       progressr_0.17.0        metadat_1.4-0          
 [46] timechange_0.3.0        nnls_1.6                abind_1.4-8            
 [49] compiler_4.5.1          fontquiver_0.2.1        withr_3.0.2            
 [52] doParallel_1.0.17       S7_0.2.0                backports_1.5.0        
 [55] metafor_4.8-0           DBI_1.2.3               SuperLearner_2.0-29    
 [58] qs_0.27.3               fastDummies_1.7.5       MetaUtility_2.1.2      
 [61] pan_1.9                 MASS_7.3-65             openssl_2.3.4          
 [64] tools_4.5.1             zip_2.3.3               future.apply_1.20.0    
 [67] nnet_7.3-20             glue_1.8.0              nlme_3.1-168           
 [70] grid_4.5.1              origami_1.0.7           checkmate_2.3.3        
 [73] generics_0.1.4          gtable_0.3.6            tzdb_0.5.0             
 [76] RApiSerialize_0.1.4     data.table_1.17.8       hms_1.1.4              
 [79] utf8_1.2.6              stringfish_0.17.0       xml2_1.4.1             
 [82] foreach_1.5.2           pillar_1.11.1           clarify_0.2.2          
 [85] mitools_2.4             splines_4.5.1           lattice_0.22-7         
 [88] survival_3.8-3          tidyselect_1.2.1        fontLiberation_0.1.0   
 [91] maq_0.6.0               fontBitstreamVera_0.1.1 reformulas_0.4.2       
 [94] svglite_2.2.2           xfun_0.53               stringi_1.8.7          
 [97] yaml_2.3.10             boot_1.3-32             ggokabeito_0.1.0       
[100] evaluate_1.0.5          codetools_0.2-20        officer_0.7.0          
[103] gdtools_0.4.4           cli_3.6.5               RcppParallel_5.1.11-1  
[106] rpart_4.1.24            systemfonts_1.3.1       Rdpack_2.6.4           
[109] Rcpp_1.1.0              globals_0.18.0          ggeffects_2.3.1        
[112] WeightIt_1.5.0          EValue_4.1.4            parallel_4.5.1         
[115] policytree_1.2.3        assertthat_0.2.1        miceadds_3.18-36       
[118] lme4_1.1-37             listenv_0.9.1           margot_1.0.266         
[121] glmnet_4.1-10           viridisLite_0.4.2       scales_1.4.0           
[124] insight_1.4.2           crayon_1.5.3            flextable_0.9.10       
[127] rlang_1.1.6             mice_3.18.0            </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>